# Nutrai API
This project contains a Go Restful API that helps users manage their diet plans. The diet plan is generated by an AI.

# Table of Contents
- [Nutrai API](#nutrai-api)
- [Table of Contents](#table-of-contents)
  - [Requirements](#requirements)
  - [Initial Setup](#initial-setup)
      - [Clone the repository](#clone-the-repository)
      - [Initialize the project (DO NOT SKIP)](#initialize-the-project-do-not-skip)
  - [How to run](#how-to-run)
    - [Development mode](#development-mode)
    - [Production mode](#production-mode)
  - [Migrations](#migrations)
  - [Tests](#tests)
      - [Run all tests](#run-all-tests)
      - [Run unit tests](#run-unit-tests)
      - [Run integration tests](#run-integration-tests)
  - [Makefile](#makefile)
    - [Help command](#help-command)

## Requirements
- [Go 1.20](https://golang.org/doc/install)
- [Docker](https://docs.docker.com/install/)
- [Docker Compose v2](https://docs.docker.com/compose/install/)
- [Make](https://www.gnu.org/software/make/)
- [Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)

## Initial Setup
#### Clone the repository
```sh
git clone https://github.com/christian-gama/nutrai-api.git
```

#### Initialize the project (DO NOT SKIP)
The command to initialize the project will automatically create the environment files if they don't exist and also make the git hooks and scripts executable.
```sh
make init
```

## How to run
If you opt to run the project locally, without docker, it will start the Postgres image regardless and use it automatically. Both production and development modes does not run migrations automatically. Please refer to the [migration section](#migrations) to learn more.
### Development mode
The development mode will run the application using [air](https://github.com/cosmtrek/air). It will watch for any changes in the project and automatically reload if necessary.
```sh
make dev
```

OR

```sh
make docker-dev
```
----------
### Production mode
The production mode will build the project and run the binary that was built. It will also use the production environment variables. 
```sh
make prod
```
OR

```sh
make docker-prod
```

## Migrations
There are a few commands related to migrations. You can use: `up`, `down`, `drop`, `reset`, `version` and `step`. Each option is documented and explained in the [makefile](#makefile). Migrations never run automatically, you must explicitly run it.

## Tests
Tests that contains database connection will automatically migrate the database schema before running the tests.

#### Run all tests
```sh
make test
```

#### Run unit tests
```sh
make test-unit
```

#### Run integration tests
```sh
make test-integration
```

## Makefile
The Makefile contains all the commands needed to run the project, tests and build the docker image. Please read the [Makefile](Makefile) for more details.

### Help command
You can use the help command to see all the available targets with a short description. You can read the [Makefile](Makefile) for more details about each target and how to use them.
```sh
make help
```
